# Happr API Backend ‚ú®

<img src="./public/docs.png" />

## Overview
This is the backend API for Happr, a platform enabling creators to receive "Smiles" (donations) from their fans. Built with **NestJS** and **TypeScript**, it leverages **Prisma ORM** for database interactions, **PostgreSQL** for data persistence, **BullMQ** for robust background job processing, and **JWT** for secure authentication.


## Features
-   **User Authentication**: Secure registration, login, and email verification processes.
-   **JWT-based Authorization**: Utilizes JSON Web Tokens for API access and refresh token management.
-   **Email Service**: Integrated email sending for user verification and welcome messages via Nodemailer, powered by BullMQ for asynchronous processing.
-   **PostgreSQL Database**: Reliable data storage managed through Prisma ORM.
-   **Prisma ORM**: Type-safe database access and migrations for a seamless development experience.
-   **Asynchronous Job Processing**: Employs BullMQ with Redis to handle background tasks like email dispatch, ensuring responsiveness.
-   **API Documentation**: Comprehensive interactive API documentation generated by Swagger.
-   **Environment Variable Management**: Robust configuration using `@nestjs/config`.
-   **CORS Configuration**: Secure cross-origin resource sharing setup.

## Getting Started
To get this project up and running locally, follow these steps:

### Installation
1.  **Clone the repository:**
    ```bash
    git clone <repository-url>
    cd server
    ```
2.  **Install dependencies:**
    ```bash
    npm install
    ```
3.  **Set up the database:**
    Ensure you have a PostgreSQL database instance running.
    Run Prisma migrations to create the necessary tables:
    ```bash
    npx prisma migrate dev --name init
    npx prisma generate
    ```

### Environment Variables
Create a `.env` file in the `server/` directory and populate it with the following variables. Examples are provided for guidance:

```env
# Database Configuration
DATABASE_URL="postgresql://user:password@localhost:5432/happr_db?schema=public"

# Redis Configuration for BullMQ
REDIS_URL="redis://localhost:6379"

# Application Configuration
PORT=5000
FRONTEND_DOMAIN="http://localhost:3000" # Your frontend application URL

# JWT Secret for token signing
JWT_SECRET="your_strong_jwt_secret_key"

# Gmail SMTP Configuration for Nodemailer
GMAIL_AUTH_USER="your_email@gmail.com"
GMAIL_AUTH_PASS="your_gmail_app_password"
```

## Usage
### Running the Application
To start the backend server:

*   **Development Mode (with hot-reloading):**
    ```bash
    npm run start:dev
    ```
*   **Production Mode:**
    ```bash
    npm run start:prod
    ```

The API will be available at `http://localhost:5000` (or your specified `PORT`).

### API Documentation
Once the server is running, you can access the interactive Swagger API documentation at:
`http://localhost:5000/docs`

This interface allows you to explore all available endpoints, understand request/response structures, and test the API directly from your browser.

## API Documentation

### Base URL
`http://localhost:5000`

### Endpoints

#### GET /auth/username-availability
**Overview**: Checks if a given username is available for registration.

**Request**:
Query Parameters:
- `username`: The username to check.
```json
{
  "username": "johndoe"
}
```
**Response**:
Success (Username available):
```json
{
  "success": true,
  "message": "johndoe is available",
  "data": []
}
```
**Errors**:
- `400 Bad Request`: Username is already taken.
  ```json
  {
    "success": false,
    "message": "\"johndoe\" is already taken",
    "data": []
  }
  ```

#### POST /auth/register
**Overview**: Registers a new user with an email, username, and password.

**Request**:
Payload:
- `email` (string, required): User's email address.
- `username` (string, required): User's unique username (3-12 characters).
- `password` (string, required): User's password (min 5 characters, must contain uppercase, number, special character).
```json
{
  "email": "user@example.com",
  "username": "newuser123",
  "password": "Password123!"
}
```
**Response**:
Success:
```json
{
  "success": true,
  "message": "Account created. Please verify your email",
  "data": []
}
```
**Errors**:
- `400 Bad Request`: Account already exists (email or username), or validation fails.
  ```json
  {
    "success": false,
    "message": "Account already exists",
    "data": []
  }
  ```
  Or for validation:
  ```json
  {
    "success": false,
    "message": "Password must contain at least one uppercase letter",
    "data": []
  }
  ```

#### GET /auth/verify-email
**Overview**: Verifies a user's email address using a token.

**Request**:
Query Parameters:
- `token` (string, required): The verification token received in the email.
```json
{
  "token": "your_verification_token_here"
}
```
**Response**:
Success:
```json
{
  "success": true,
  "message": "Email verified successfully!",
  "data": []
}
```
**Errors**:
- `400 Bad Request`: Invalid or expired token, user not found, or email already verified.
  ```json
  {
    "success": false,
    "message": "Invalid or expired token!",
    "data": []
  }
  ```
  Or:
  ```json
  {
    "success": false,
    "message": "Email already verified, just login!",
    "data": []
  }
  ```

#### POST /auth/signin
**Overview**: Authenticates a user and sets `access_token` and `refresh_token` cookies.

**Request**:
Payload:
- `email` (string, required): User's email address.
- `password` (string, required): User's password.
```json
{
  "email": "user@example.com",
  "password": "Password123!"
}
```
**Response**:
Success: Cookies `access_token` and `refresh_token` are set.
```json
{
  "success": true,
  "message": "User signedin successfully",
  "data": []
}
```
**Errors**:
- `401 Unauthorized`: Invalid credentials or unverified email.
  ```json
  {
    "success": false,
    "message": "Invalid credentials",
    "data": []
  }
  ```
  Or:
  ```json
  {
    "success": false,
    "message": "Your account has not been verified yet, kindly check your email",
    "data": []
  }
  ```

## Technologies Used
| Technology          | Description                                    | Version | Link                                                |
| :------------------ | :--------------------------------------------- | :------ | :-------------------------------------------------- |
| Node.js             | JavaScript runtime environment                 | 18+     | [nodejs.org](https://nodejs.org/)                   |
| NestJS              | Progressive Node.js framework for building efficient, reliable, and scalable server-side applications | 11.x    | [nestjs.com](https://nestjs.com/)                   |
| TypeScript          | Superset of JavaScript that compiles to plain JavaScript | 5.x     | [typescriptlang.org](https://www.typescriptlang.org/)|
| Prisma ORM          | Next-generation ORM for Node.js and TypeScript | 6.x     | [prisma.io](https://www.prisma.io/)                 |
| PostgreSQL          | Powerful, open-source object-relational database system | -       | [postgresql.org](https://www.postgresql.org/)       |
| BullMQ              | Robust, Redis-backed job queue for Node.js     | 5.x     | [bullmq.io](https://bullmq.io/)                     |
| Nodemailer          | Module for sending emails with Node.js         | 7.x     | [nodemailer.com](https://nodemailer.com/)           |
| Argon2              | Password hashing function                      | 0.44.x  | [npmjs.com/package/argon2](https://www.npmjs.com/package/argon2) |
| Swagger             | API documentation framework                    | 5.x     | [swagger.io](https://swagger.io/)                   |

## Contributing
We welcome contributions to the Happr API backend! If you're interested in improving the project, please follow these guidelines:

*   **Fork the repository** üç¥ and clone it to your local machine.
*   **Create a new branch** for your feature or bug fix: `git checkout -b feature/your-feature-name` or `bugfix/issue-description`.
*   **Make your changes**, adhering to the existing coding style and conventions (Prettier, ESLint).
*   **Write clear, concise commit messages** üìù that explain your changes.
*   **Ensure all tests pass** (`npm test`) and add new tests for your features if applicable.
*   **Submit a pull request** outlining the purpose of your changes.

## License
This project is currently UNLICENSED.

## Author Info
Developed by a passionate developer with a knack for building scalable backend systems.

*   **LinkedIn**: [Your LinkedIn Profile](https://www.linkedin.com/in/yourprofile)
*   **Twitter**: [Your Twitter Handle](https://twitter.com/yourhandle)
*   **Portfolio**: [Your Portfolio Website](https://www.yourportfolio.com)

---
[![Node.js](https://img.shields.io/badge/Node.js-18%2B-green?logo=node.js)](https://nodejs.org/)
[![NestJS](https://img.shields.io/badge/NestJS-11.x-red?logo=nestjs)](https://nestjs.com/)
[![TypeScript](https://img.shields.io/badge/TypeScript-5.x-blue?logo=typescript)](https://www.typescriptlang.org/)
[![Prisma](https://img.shields.io/badge/Prisma-6.x-blueviolet?logo=prisma)](https://www.prisma.io/)
[![PostgreSQL](https://img.shields.io/badge/PostgreSQL-Any-blue?logo=postgresql)](https://www.postgresql.org/)
[![BullMQ](https://img.shields.io/badge/BullMQ-5.x-red?logo=redis)](https://bullmq.io/)
[![License](https://img.shields.io/badge/License-UNLICENSED-red)](https://choosealicense.com/licenses/unlicense/)
[![Prettier](https://img.shields.io/badge/Code_Style-Prettier-ff69b4?logo=prettier)](https://prettier.io/)
[![ESLint](https://img.shields.io/badge/Linter-ESLint-4b32c3?logo=eslint)](https://eslint.org/)
[![npm version](https://img.shields.io/badge/npm-v9.x-brightgreen?logo=npm)](https://www.npmjs.com/)
[![Build Status](https://img.shields.io/badge/Build-Passing-brightgreen)](https://github.com/your-username/your-repo/actions)
[![Readme was generated by Dokugen](https://img.shields.io/badge/Readme%20was%20generated%20by-Dokugen-brightgreen)](https://www.npmjs.com/package/dokugen)