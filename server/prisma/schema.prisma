generator client {
  provider = "prisma-client-js"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id             String       @id @default(cuid())
  email          String       @unique
  password       String?      // nullable for Google users
  username       String       @unique
  bio            String?
  avatar_url     String?
  display_name   String?
  phone_number   String?
  auth_provider  String       @default("local") // "local" or "google"
  created_at     DateTime     @default(now())
  updated_at     DateTime     @updatedAt
  is_verified    Boolean      @default(false)
  bank_account   BankAccount? @relation(fields: [bank_account_id], references: [id], onDelete: SetNull)
  bank_account_id String?     @unique 

  donations      Donation[]   // donations received
  supports       Donation[]   @relation("UserSupport") // donations given
  refresh_tokens RefreshToken[]

  @@index([username, email])
}

model RefreshToken {
  id         String   @id @default(cuid())
  token      String   @unique
  user       User     @relation(fields: [user_id], references: [id], onDelete: Cascade)
  user_id    String
  created_at DateTime @default(now())
  expires_at DateTime?

  @@index([user_id])
}

model BankAccount {
  id             String  @id @default(cuid())
  bank_name      String
  account_name   String
  account_number String  @unique
  user           User?   @relation
}

model Donation {
  id            String   @id @default(cuid())
  amount        Float
  message       String?
  name          String?
  email         String?
  is_guest      Boolean  @default(false)
  created_at    DateTime @default(now())

  creator       User     @relation(fields: [creator_id], references: [id], onDelete: Cascade)
  creator_id    String

  supporter     User?    @relation("UserSupport", fields: [supporter_id], references: [id], onDelete: SetNull)
  supporter_id  String?
}


